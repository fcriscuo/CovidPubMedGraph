# CovidPubMedGraph
A set of R scripts to create a Neo4j graph database mapping PubMed entries related to COVID-19
The database is seeded by loading entries from a list of related PubMed entries (eg. disease, gene,
etc). In this example, The PubMed Ids were generated by the Covid-Graph Project (https://covidgraph.org/)
and represent PubMed articles related to Covid-19. In the Neo4j database, the PubMed nodes for these seed
articles are assigned an additional label (i.e. Covid). After the primary PubMed articles have been loaded,
data for the PubMed articles referenced by these articles are loaded as a second level of articles. This
process is repeated until a specified number of levels has been loaded (i.e. Primary -> Level 2 -> Level 3 ...
Level n). When all PubMed nodes have been loaded, queries are sent to NCBI for the PubMed Ids of articles
that cite each PubMed article in the database. A summary node is created in the Neo4j database is created
for each of these cited-by PubMed articles.

## Neo4j Database Creation Steps:
### 1. Determine the n most-cited PubMed papers related to COVID-19
Using the latest metadata.csv file published by the Covid-Graph project,
invoke the top_cited_articles function in the select_top_cited_articles.R script. Inputs to this 
function are (1) the file path to the downloaded csv file and (2) the number of top-cited 
articles to return. Default values are provided for both parameters. NCBI imposes a
3 requests / second limit, so this script requires a significant amount of time
to complete. To accomodate service interruptions, intermediate results are written
to the output file, top_cited_articles.csv. When the script is subsequently restarted,
it will incorporate the intermediate results and resume processing from where 
it left off. The output file also keeps track of how many entries from the
input file were processed and these records will be skipped on a restart. The
final result will be a list of PubMed Ids sorted in descending order by the 
number of times they have been cited.

### 2. Define Neo4j database constraints
Before data are loaded into the Neo4j database, the covid_constraint_defs.R 
script must be executed. This script invokes Cypher constraint definitions
that prevent duplication of critical identifiers (e.g. PubMed Ids, Authors).
This step can be skipped if the dataabse has already been created.

### 3. Load PubMed entries into the Neo4j database
The covid_pubmed_graph.R script will process a list of PubMed Ids and request
data from PubMed for each entry in XML format. Data from each response will
be mapped to nodes and relationships in the Neo4j database. Input to this
script is expected to be the output from the select_top_cited_articles.R
script, but can be any csv file that has a pubmed_id labeled column. Values
for all script parameters are specified in the app_default.properties file.
Of particular importance is the load.database.mode property. If this property 
is set as CREATE, the script will clear all nodes and relationships from the
neo4j database. The user is given a warning and a 15 second window to terminate
execution if this is not his/her intent.
As with determining the top-cited articles, loading the database
is constrained by the NCBI maximum request rate. As a result, this script is
vulnerable to NCBI session interruptions. To compensate for such interruptions,
the script is restartable. To restart the script, the load.database.mode
property should be set to anything other than CREATE (e.g. UPDATE).
When the script is executed in CREATE mode, requests to NCBI will be in batch mode.
The batch size is determined by the batch.request.size property.
